<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
        <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
        <title>FACE Countries Page</title>
        <script type="text/javascript" src="http://www.google.com/jsapi">
        </script>
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false">
        </script>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/dojo/1.6/dojo/dojo.xd.js" djConfig="parseOnLoad: true">
        </script>
        <link rel="stylesheet" type="text/css" href="http://code.google.com/apis/maps/documentation/javascript/examples/default.css"/>
        <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/dojo/1.6/dijit/themes/claro/claro.css"/>
        <link rel="stylesheet" type="text/css" href="styles/styles.css">
        <script type="text/javascript">
            dojo.require("dojo.data.ItemFileReadStore");
            dojo.require("dojo.io.script");
            dojo.require("dojox.grid.DataGrid");
            dojo.require("dojox.data.CsvStore");
            dojo.addOnLoad(onLoad);
            function onLoad(){
                dojo.io.script.get({
                    url: "http://www.google.com/fusiontables/api/query?sql=select%20*%20from%201014134%20order%20by%20Code&jsonCallback=done2"
                });
            }
            
            function done(){
                var store4 = new dojox.data.CsvStore({
                    url: 'js/movies.csv'
                });
                var layout4 = [{
                    field: 'Title',
                    name: 'Title of Movie',
                    width: '200px'
                }, {
                    field: 'Year',
                    name: 'Year',
                    width: '50px'
                }, {
                    field: 'Producer',
                    name: 'Producer',
                    width: 'auto'
                }];
                
                layout4.push({
                    field: 'wibble',
                    name: 'wobble',
                    width: '50px'
                })
                // create a new grid:
                var grid4 = new dojox.grid.DataGrid({
                    query: {
                        Title: '*'
                    },
                    store: store4,
                    clientSort: true,
                    rowSelector: '20px',
                    structure: layout4
                }, document.createElement('div'));
                
                // append the new grid to the div "gridContainer4":
                dojo.byId("gridContainer4").appendChild(grid4.domNode);
                
                // Call startup, in order to render the grid:
                grid4.startup();
                
            }
            
            function done2(results){
                var rows = results.table.rows;
                var items = [];
                dojo.forEach(rows, function(row, i){
                    items.push({
                        code: row[0]
                    });
                });
                countriesStore.data = {
                    identifier: "code",
                    label: "code",
                    items: items
                };
                var cols = [];
                dojo.forEach(results.table.cols, function(column, i){
                    cols.push({
                        field: column,
                        name: column,
                        width: '50px'
                    });
                });
                var grid = new dojox.grid.DataGrid({
                    store: countriesStore,
                    rowSelector: '20px',
                    structure: cols
                }, document.createElement('div'));
                dojo.byId("gridContainer4").appendChild(grid.domNode);
                grid.startup();
                
            }
        </script>
    </head>
    <body>
        <div dojoType="dojo.data.ItemFileReadStore" jsId="countriesStore">
        </div>
        <div id="gridContainer4" style="width: 100%; height: 100%;">
        </div>
    </body>
</html>
